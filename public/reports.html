<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reports - HudumaQ Admin</title>
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css">
  <!-- Add export libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<style>
  /* Base Styles & Variables */
:root {
  --primary-color: #4361ee;
  --primary-light: #e6e9ff;
  --secondary-color: #3f37c9;
  --success-color: #4cc9f0;
  --warning-color: #f8961e;
  --danger-color: #f94144;
  --light-color: #f8f9fa;
  --dark-color: #212529;
  --gray-color: #6c757d;
  --light-gray: #e9ecef;
  --border-radius: 8px;
  --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  --transition: all 0.3s ease;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', sans-serif;
  background-color: #f5f7fb;
  color: var(--dark-color);
  line-height: 1.6;
}

/* Dashboard Layout */
.dashboard-container {
  display: flex;
  min-height: 100vh;
}

/* Sidebar Styles */
.sidebar {
  width: 250px;
  background: white;
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
  transition: var(--transition);
  z-index: 100;
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--light-gray);
}

.logo {
  display: flex;
  align-items: center;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary-color);
  text-decoration: none;
}

.logo i {
  margin-right: 10px;
  font-size: 1.8rem;
}

.sidebar-nav {
  flex: 1;
  padding: 1rem 0;
}

.sidebar-nav ul {
  list-style: none;
}

.sidebar-nav li a {
  display: flex;
  align-items: center;
  padding: 0.8rem 1.5rem;
  color: var(--gray-color);
  text-decoration: none;
  transition: var(--transition);
}

.sidebar-nav li a i {
  margin-right: 10px;
  font-size: 1.1rem;
  width: 20px;
  text-align: center;
}

.sidebar-nav li a:hover {
  background-color: var(--primary-light);
  color: var(--primary-color);
}

.sidebar-nav li.active a {
  background-color: var(--primary-light);
  color: var(--primary-color);
  border-left: 3px solid var(--primary-color);
}

.sidebar-footer {
  padding: 1.5rem;
  border-top: 1px solid var(--light-gray);
}

.logout-btn {
  display: flex;
  align-items: center;
  color: var(--gray-color);
  text-decoration: none;
  transition: var(--transition);
}

.logout-btn:hover {
  color: var(--danger-color);
}

.logout-btn i {
  margin-right: 10px;
}

/* Main Content Styles */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.top-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background: white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  z-index: 90;
}

.search-bar {
  position: relative;
  width: 300px;
}

.search-bar i {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray-color);
}

.search-bar input {
  width: 100%;
  padding: 0.5rem 1rem 0.5rem 2.5rem;
  border: 1px solid var(--light-gray);
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.search-bar input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

.user-profile {
  display: flex;
  align-items: center;
  position: relative;
}

.notification-bell {
  position: relative;
  margin-right: 1.5rem;
  cursor: pointer;
}

.notification-bell i {
  font-size: 1.2rem;
  color: var(--gray-color);
}

.notification-count {
  position: absolute;
  top: -5px;
  right: -5px;
  background: var(--danger-color);
  color: white;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  font-size: 0.7rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.profile-dropdown {
  display: flex;
  align-items: center;
  cursor: pointer;
  position: relative;
}

.profile-dropdown img {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin-right: 10px;
}

.profile-dropdown span {
  margin-right: 8px;
  font-weight: 500;
}

/* Dropdown Menu Styles */
.dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  background: white;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  min-width: 200px;
  z-index: 1000;
  display: none;
  margin-top: 10px;
}

.dropdown-menu.show {
  display: block;
}

.dropdown-menu a {
  display: flex;
  align-items: center;
  padding: 0.8rem 1rem;
  color: var(--dark-color);
  text-decoration: none;
  transition: var(--transition);
}

.dropdown-menu a:hover {
  background-color: var(--primary-light);
  color: var(--primary-color);
}

.dropdown-menu a i {
  margin-right: 10px;
  width: 20px;
  text-align: center;
}

.dropdown-divider {
  height: 1px;
  background-color: var(--light-gray);
  margin: 0.5rem 0;
}

/* Dashboard Content */
.dashboard-content {
  flex: 1;
  padding: 1.5rem;
  overflow-y: auto;
}

.page-header {
  margin-bottom: 2rem;
}

.page-header h1 {
  font-size: 1.8rem;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
}

.page-header h1 i {
  margin-right: 10px;
  color: var(--primary-color);
}

.page-header p {
  color: var(--gray-color);
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: white;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  padding: 1.5rem;
  display: flex;
  transition: var(--transition);
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
}

.stat-icon {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  font-size: 1.5rem;
  color: white;
}

.bg-primary {
  background-color: var(--primary-color);
}

.bg-success {
  background-color: var(--success-color);
}

.bg-warning {
  background-color: var(--warning-color);
}

.bg-danger {
  background-color: var(--danger-color);
}

.stat-info h3 {
  font-size: 1.8rem;
  margin-bottom: 0.3rem;
}

.stat-info p {
  color: var(--gray-color);
  font-size: 0.9rem;
}

.stat-change {
  font-size: 0.8rem;
  margin-top: 0.3rem;
  display: flex;
  align-items: center;
}

.stat-change i {
  margin-right: 4px;
  font-size: 0.7rem;
}

.positive {
  color: #2ecc71;
}

.negative {
  color: var(--danger-color);
}

.neutral {
  color: var(--gray-color);
}

/* Quick Actions */
.quick-actions {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
  flex-wrap: wrap;
}

.action-btn {
  background: white;
  border: 1px solid var(--light-gray);
  border-radius: var(--border-radius);
  padding: 0.7rem 1.2rem;
  display: flex;
  align-items: center;
  cursor: pointer;
  transition: var(--transition);
  font-weight: 500;
}

.action-btn.active {
  background: var(--primary-light);
  border-color: var(--primary-color);
  color: var(--primary-color);
}

.action-btn i {
  margin-right: 8px;
}

.action-btn:hover {
  background: var(--primary-light);
  border-color: var(--primary-color);
  color: var(--primary-color);
}

/* Data Card */
.data-card {
  background: white;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  margin-bottom: 2rem;
}

.card-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--light-gray);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.card-header h2 {
  display: flex;
  align-items: center;
  font-size: 1.3rem;
}

.card-header h2 i {
  margin-right: 10px;
  color: var(--primary-color);
}

.filter-controls {
  display: flex;
  gap: 1rem;
  align-items: center;
  flex-wrap: wrap;
}

.filter-group {
  display: flex;
  flex-direction: column;
}

.filter-group label {
  font-size: 0.8rem;
  margin-bottom: 4px;
  color: var(--gray-color);
  display: flex;
  align-items: center;
}

.filter-group label i {
  margin-right: 5px;
}

.filter-group select,
.filter-group input {
  padding: 0.5rem;
  border: 1px solid var(--light-gray);
  border-radius: var(--border-radius);
  min-width: 150px;
}

.filter-btn {
  background: var(--primary-color);
  color: white;
  border: none;
  border-radius: var(--border-radius);
  padding: 0.5rem 1rem;
  cursor: pointer;
  transition: var(--transition);
  align-self: flex-end;
}

.filter-btn:hover {
  background: var(--secondary-color);
}

/* Table Styles */
.table-container {
  overflow-x: auto;
  padding: 0 1.5rem;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  margin: 1rem 0;
}

.data-table th {
  text-align: left;
  padding: 1rem;
  font-weight: 600;
  color: var(--gray-color);
  border-bottom: 1px solid var(--light-gray);
  white-space: nowrap;
}

.data-table th i {
  margin-left: 5px;
  color: var(--light-gray);
  cursor: pointer;
}

.data-table td {
  padding: 1rem;
  border-bottom: 1px solid var(--light-gray);
  white-space: nowrap;
}

.data-table tr:last-child td {
  border-bottom: none;
}

.data-table tr:hover {
  background-color: #f8f9fa;
}

.status-badge {
  display: inline-block;
  padding: 0.3rem 0.6rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 500;
}

.completed {
  background-color: #d4edda;
  color: #155724;
}

.pending {
  background-color: #fff3cd;
  color: #856404;
}

.in-progress {
  background-color: #cce5ff;
  color: #004085;
}

.failed {
  background-color: #f8d7da;
  color: #721c24;
}

.action-icon {
  background: none;
  border: none;
  color: var(--gray-color);
  cursor: pointer;
  margin-right: 10px;
  transition: var(--transition);
  font-size: 1rem;
}

.action-icon:hover {
  color: var(--primary-color);
}

/* Card Footer */
.card-footer {
  padding: 1rem 1.5rem;
  border-top: 1px solid var(--light-gray);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.table-info {
  color: var(--gray-color);
  font-size: 0.9rem;
}

.table-info span {
  font-weight: 600;
}

.pagination {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.pagination-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 1px solid var(--light-gray);
  background: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

.pagination-btn:hover {
  border-color: var(--primary-color);
  color: var(--primary-color);
}

.pagination-btn.active {
  background: var(--primary-color);
  color: white;
  border-color: var(--primary-color);
}

.pagination-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Chart Containers */
.chart-container {
  position: relative;
  height: 300px;
  width: 100%;
  margin-bottom: 1.5rem;
}

.chart-placeholder {
  width: 100%;
  height: 100%;
  background: #f8f9fa;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--gray-color);
  border-radius: var(--border-radius);
}

/* Report Cards */
.report-cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.report-card {
  background: white;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  padding: 1.5rem;
  transition: var(--transition);
}

.report-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
}

.report-card h3 {
  font-size: 1.1rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
}

.report-card h3 i {
  margin-right: 8px;
  color: var(--primary-color);
}

.report-card p {
  color: var(--gray-color);
  font-size: 0.9rem;
  margin-bottom: 1.5rem;
}

.report-card .chart-container {
  height: 200px;
}

/* Dashboard Footer */
.dashboard-footer {
  padding: 1rem 1.5rem;
  background: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.9rem;
  color: var(--gray-color);
}

.footer-links a {
  margin-left: 1rem;
  color: var(--gray-color);
  text-decoration: none;
}

.footer-links a:hover {
  color: var(--primary-color);
}

/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 2000;
  align-items: center;
  justify-content: center;
}

.modal.show {
  display: flex;
}

.modal-content {
  background: white;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  width: 90%;
  max-width: 800px;
  max-height: 90vh;
  overflow-y: auto;
}

.modal-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--light-gray);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h3 {
  font-size: 1.3rem;
  display: flex;
  align-items: center;
}

.modal-header h3 i {
  margin-right: 10px;
  color: var(--primary-color);
}

.close-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--gray-color);
}

.modal-body {
  padding: 1.5rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.form-control {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--light-gray);
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.form-control:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

.form-row {
  display: flex;
  gap: 1rem;
}

.form-row .form-group {
  flex: 1;
}

.modal-footer {
  padding: 1rem 1.5rem;
  border-top: 1px solid var(--light-gray);
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
}

.btn {
  padding: 0.75rem 1.5rem;
  border-radius: var(--border-radius);
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
}

.btn-primary {
  background: var(--primary-color);
  color: white;
  border: none;
}

.btn-primary:hover {
  background: var(--secondary-color);
}

.btn-secondary {
  background: white;
  color: var(--dark-color);
  border: 1px solid var(--light-gray);
}

.btn-secondary:hover {
  background: var(--light-gray);
}

/* Responsive Adjustments */
@media (max-width: 992px) {
  .sidebar {
    width: 70px;
    overflow: hidden;
  }
  
  .sidebar-header .logo span,
  .sidebar-nav li a span,
  .logout-btn span {
    display: none;
  }
  
  .sidebar-nav li a {
    justify-content: center;
    padding: 1rem;
  }
  
  .sidebar-nav li a i {
    margin-right: 0;
    font-size: 1.3rem;
  }
  
  .sidebar-footer {
    padding: 1rem;
  }
}

@media (max-width: 768px) {
  .filter-controls {
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
  }
  
  .filter-group {
    width: 100%;
  }
  
  .filter-group select,
  .filter-group input {
    width: 100%;
  }
  
  .filter-btn {
    width: 100%;
  }
  
  .stats-grid {
    grid-template-columns: 1fr 1fr;
  }

  .form-row {
    flex-direction: column;
    gap: 0;
  }
}

@media (max-width: 576px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .quick-actions {
    flex-direction: column;
  }
  
  .action-btn {
    width: 100%;
    justify-content: center;
  }
  
  .card-footer {
    flex-direction: column;
    gap: 1rem;
  }
  
  .pagination {
    margin-top: 1rem;
  }
  
  .top-nav {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
  
  .search-bar {
    width: 100%;
  }
  
  .user-profile {
    width: 100%;
    justify-content: flex-end;
  }

  .modal-content {
    width: 95%;
  }

  .report-cards {
    grid-template-columns: 1fr;
  }
}
</style>
<body>
  <!-- Sidebar Navigation -->
  <div class="dashboard-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="logo">
          <i class="fas fa-handshake"></i> HudumaQ
        </a>
      </div>
      
      <nav class="sidebar-nav">
        <ul>
          <li>
            <a href="admin.html">
              <i class="fas fa-tachometer-alt"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
            <a href="appointments.html">
              <i class="fas fa-calendar-alt"></i>
              <span>Appointments</span>
            </a>
          </li>
          <li>
            <a href="service_centers.html">
              <i class="fas fa-map-marker-alt"></i>
              <span>Service Centers</span>
            </a>
          </li>
          <li>
            <a href="settings.html">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </a>
          </li>
          <li class="active">
            <a href="reports.html">
              <i class="fas fa-chart-line"></i>
              <span>Reports</span>
            </a>
          </li>
          <li>
            <a href="users.html">
              <i class="fas fa-users"></i>
              <span>Users</span>
            </a>
          </li>
        </ul>
      </nav>
      
      <div class="sidebar-footer">
        <a href="login.html" class="logout-btn">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Navigation -->
      <header class="top-nav">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search reports...">
        </div>
        
        <div class="user-profile">
          <div class="notification-bell">
            <i class="fas fa-bell"></i>
            <span class="notification-count">3</span>
          </div>
          <div class="profile-dropdown" id="profileDropdown">
            <img src="https://via.placeholder.com/40" alt="Admin Profile">
            <span>Admin User</span>
            <i class="fas fa-chevron-down"></i>
            
            <!-- Dropdown Menu -->
            <div class="dropdown-menu" id="dropdownMenu">
              <a href="#">
                <i class="fas fa-user"></i> My Profile
              </a>
              <a href="settings.html">
                <i class="fas fa-cog"></i> Settings
              </a>
              <div class="dropdown-divider"></div>
              <a href="login.html">
                <i class="fas fa-sign-out-alt"></i> Logout
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Dashboard Content -->
      <section class="dashboard-content">
        <div class="page-header">
          <h1><i class="fas fa-chart-line"></i> Reports & Analytics</h1>
          <p>Comprehensive reports and insights about HudumaQ operations</p>
        </div>

        <!-- Tab Navigation with Export Button -->
        <div class="quick-actions" style="margin-bottom: 1rem;">
          <button class="action-btn active" id="appointmentsTab">Appointments</button>
          <button class="action-btn" id="performanceTab">Performance</button>
          <button class="action-btn" id="systemTab">System Reports</button>
          <button class="action-btn" id="generateReportBtn" style="margin-left: auto;">
            <i class="fas fa-file-export"></i> Generate Report
          </button>
        </div>

        <!-- Appointments Report Section -->
        <div id="appointmentsReportSection">
          <!-- Stats Grid for Appointments -->
          <div class="stats-grid">
            <div class="stat-card" id="totalAppointmentsStat">
              <div class="stat-icon bg-primary">
                <i class="fas fa-calendar-check"></i>
              </div>
              <div class="stat-info">
                <h3 id="totalAppointments">0</h3>
                <p>Total Appointments</p>
                <span class="stat-change neutral" id="totalAppointmentsChange">
                  <i class="fas fa-spinner fa-spin"></i> Loading data...
                </span>
              </div>
            </div>
            
            <div class="stat-card" id="completedServicesStat">
              <div class="stat-icon bg-success">
                <i class="fas fa-user-check"></i>
              </div>
              <div class="stat-info">
                <h3 id="completedServices">0</h3>
                <p>Completed Services</p>
                <span class="stat-change neutral" id="completedServicesChange">
                  <i class="fas fa-spinner fa-spin"></i> Loading data...
                </span>
              </div>
            </div>
            
            <div class="stat-card" id="avgWaitTimeStat">
              <div class="stat-icon bg-warning">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-info">
                <h3 id="avgWaitTime">0</h3>
                <p>Average Wait Time</p>
                <span class="stat-change neutral" id="avgWaitTimeChange">
                  <i class="fas fa-spinner fa-spin"></i> Loading data...
                </span>
              </div>
            </div>
            
            <div class="stat-card" id="cancellationRateStat">
              <div class="stat-icon bg-danger">
                <i class="fas fa-user-times"></i>
              </div>
              <div class="stat-info">
                <h3 id="cancellationRate">0%</h3>
                <p>Cancellation Rate</p>
                <span class="stat-change neutral" id="cancellationRateChange">
                  <i class="fas fa-spinner fa-spin"></i> Loading data...
                </span>
              </div>
            </div>
          </div>

          <!-- Appointments Charts -->
          <div class="report-cards">
            <div class="report-card">
              <h3><i class="fas fa-calendar-day"></i> Daily Appointments</h3>
              <p>Trend of appointments booked and completed over time</p>
              <div class="chart-container">
                <canvas id="dailyAppointmentsChart"></canvas>
              </div>
            </div>
            
            <div class="report-card">
              <h3><i class="fas fa-map-marker-alt"></i> Center Distribution</h3>
              <p>Breakdown of appointments by service center</p>
              <div class="chart-container">
                <canvas id="centerDistributionChart"></canvas>
              </div>
            </div>
            
            <div class="report-card">
              <h3><i class="fas fa-concierge-bell"></i> Service Distribution</h3>
              <p>Breakdown of services requested across all centers</p>
              <div class="chart-container">
                <canvas id="serviceDistributionChart"></canvas>
              </div>
            </div>
            
            <div class="report-card">
              <h3><i class="fas fa-clock"></i> Status Distribution</h3>
              <p>Current status of all appointments in the system</p>
              <div class="chart-container">
                <canvas id="statusDistributionChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Appointments Data Table -->
          <div class="data-card">
            <div class="card-header">
              <h2><i class="fas fa-table"></i> All Appointments</h2>
              
              <div class="filter-controls">
                <div class="filter-group">
                  <label for="appointmentDateFilter"><i class="fas fa-calendar-day"></i> Date Range</label>
                  <input type="text" id="appointmentDateFilter" class="date-picker" placeholder="Select date range">
                </div>
                
                <div class="filter-group">
                  <label for="appointmentServiceFilter"><i class="fas fa-filter"></i> Service</label>
                  <select id="appointmentServiceFilter">
                    <option value="">All Services</option>
                    <option value="ID Replacement & Applications">ID Replacement & Applications</option>
                    <option value="Birth & Death Certificates">Birth & Death Certificates</option>
                    <option value="NHIF Services">NHIF Services</option>
                    <option value="NSSF Services">NSSF Services</option>
                    <option value="KRA Services">KRA Services</option>
                    <option value="Police Clearance">Police Clearance</option>
                    <option value="Passport Services">Passport Services</option>
                  </select>
                </div>
                
                <div class="filter-group">
                  <label for="appointmentCenterFilter"><i class="fas fa-map-marker-alt"></i> Center</label>
                  <select id="appointmentCenterFilter">
                    <option value="">All Centers</option>
                    <option value="Nairobi GPO">Nairobi GPO</option>
                    <option value="Mombasa">Mombasa</option>
                    <option value="Kisumu">Kisumu</option>
                    <option value="Nakuru">Nakuru</option>
                    <option value="Eldoret">Eldoret</option>
                  </select>
                </div>
                
                <div class="filter-group">
                  <label for="appointmentStatusFilter"><i class="fas fa-info-circle"></i> Status</label>
                  <select id="appointmentStatusFilter">
                    <option value="">All Statuses</option>
                    <option value="Pending">Pending</option>
                    <option value="Confirmed">Confirmed</option>
                    <option value="Completed">Completed</option>
                    <option value="Cancelled">Cancelled</option>
                    <option value="No Show">No Show</option>
                  </select>
                </div>
                
                <button class="filter-btn" id="applyAppointmentFilters">
                  <i class="fas fa-filter"></i> Apply Filters
                </button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table" id="appointmentsTable">
                <thead>
                  <tr>
                    <th>Ref No <i class="fas fa-sort"></i></th>
                    <th>Client Name <i class="fas fa-sort"></i></th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Service <i class="fas fa-sort"></i></th>
                    <th>Center <i class="fas fa-sort"></i></th>
                    <th>Date & Time <i class="fas fa-sort"></i></th>
                    <th>Status</th>
                    <th>Queue Status</th>
                  </tr>
                </thead>
                <tbody id="appointmentsTableBody">
                  <tr>
                    <td colspan="9" class="text-center py-4">
                      <i class="fas fa-spinner fa-spin"></i> Loading appointments...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="card-footer">
              <div class="table-info">
                Showing <span id="showingFrom">0</span>-<span id="showingTo">0</span> of <span id="totalAppointmentsCount">0</span> entries
              </div>
              
              <div class="pagination" id="appointmentsPagination">
                <button class="pagination-btn" disabled id="prevAppointmentsPage">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn" id="nextAppointmentsPage">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Report Section (Hidden by default) -->
        <div id="performanceReportSection" style="display: none;">
          <!-- Performance reports content would go here -->
          <div class="data-card">
            <div class="card-header">
              <h2><i class="fas fa-chart-line"></i> Performance Reports</h2>
            </div>
            <div class="table-container">
              <p style="padding: 1.5rem;">Performance reports would be displayed here when the Performance tab is selected.</p>
            </div>
          </div>
        </div>
        
        <!-- System Report Section (Hidden by default) -->
        <div id="systemReportSection" style="display: none;">
          <!-- System reports content would go here -->
          <div class="data-card">
            <div class="card-header">
              <h2><i class="fas fa-server"></i> System Reports</h2>
            </div>
            <div class="table-container">
              <p style="padding: 1.5rem;">System reports would be displayed here when the System tab is selected.</p>
            </div>
          </div>
        </div>
      </section>

      <footer class="dashboard-footer">
        <p>&copy; 2025 HudumaQ. All rights reserved.</p>
        <div class="footer-links">
          <a href="#">Privacy Policy</a>
          <a href="#">Terms of Service</a>
          <a href="#">Help Center</a>
        </div>
      </footer>
    </main>
  </div>

  <!-- Generate Report Modal -->
  <div class="modal" id="generateReportModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-file-export"></i> Generate New Report</h3>
        <button class="close-btn" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="reportForm">
          <div class="form-group">
            <label for="reportName">Report Name</label>
            <input type="text" id="reportName" class="form-control" required>
          </div>
          
          <div class="form-group">
            <label for="reportType">Report Type</label>
            <select id="reportType" class="form-control" required>
              <option value="">Select Report Type</option>
              <option value="Appointments">Appointments Summary</option>
              <option value="Performance">Center Performance</option>
              <option value="System">System Usage</option>
            </select>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="startDate">Start Date</label>
              <input type="text" id="startDate" class="form-control date-picker" required>
            </div>
            <div class="form-group">
              <label for="endDate">End Date</label>
              <input type="text" id="endDate" class="form-control date-picker" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="reportFormat">Format</label>
            <select id="reportFormat" class="form-control" required>
              <option value="PDF">PDF</option>
              <option value="Excel">Excel</option>
              <option value="CSV">CSV</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="reportNotes">Notes (optional)</label>
            <textarea id="reportNotes" class="form-control" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelReport">Cancel</button>
        <button class="btn btn-primary" id="generateReport">Generate Report</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
  <script>
    // Global variables
    let appointments = [];
    let queueData = [];
    let filteredAppointments = [];
    let currentAppointmentsPage = 1;
    const appointmentsPerPage = 10;
    let charts = {};

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize date pickers
      flatpickr("#appointmentDateFilter", {
        mode: "range",
        dateFormat: "Y-m-d",
      });

      flatpickr("#startDate", {
        dateFormat: "Y-m-d",
      });

      flatpickr("#endDate", {
        dateFormat: "Y-m-d",
      });

      // Initialize charts
      initializeCharts();
      
      // Fetch data
      fetchAppointmentData();
      
      // Set up event listeners
      setupEventListeners();
      
      // Listen for storage changes
      window.addEventListener('storage', function(e) {
        if (e.key === 'hudumaQAppointments' || e.key === 'hudumaQBookings') {
          fetchAppointmentData();
        }
      });
    });

    // Initialize charts
    function initializeCharts() {
      const chartConfigs = {
        dailyAppointmentsChart: {
          type: 'line',
          data: { labels: [], datasets: [] },
          options: getChartOptions('Number of Appointments')
        },
        centerDistributionChart: {
          type: 'bar',
          data: { labels: [], datasets: [] },
          options: getChartOptions('Number of Appointments')
        },
        serviceDistributionChart: {
          type: 'doughnut',
          data: { labels: [], datasets: [] },
          options: getChartOptions()
        },
        statusDistributionChart: {
          type: 'pie',
          data: { labels: [], datasets: [] },
          options: getChartOptions()
        }
      };

      Object.keys(chartConfigs).forEach(chartId => {
        const ctx = document.getElementById(chartId).getContext('2d');
        charts[chartId] = new Chart(ctx, chartConfigs[chartId]);
      });
    }

    function getChartOptions(yAxisTitle = '', scales = {}) {
      return {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ...(yAxisTitle && {
              title: {
                display: true,
                text: yAxisTitle
              }
            }),
            ...scales
          }
        }
      };
    }

    // Fetch appointment data from localStorage
    async function fetchAppointmentData() {
      try {
        // Get appointments from localStorage
        const localAppointments = JSON.parse(localStorage.getItem('hudumaQAppointments')) || [];
        
        // Get queue data from localStorage
        const localQueueData = JSON.parse(localStorage.getItem('hudumaQBookings')) || [];
        
        // Merge the data
        appointments = localAppointments.map(app => {
          const queueEntry = localQueueData.find(q => q.queueNumber === app.queueNumber);
          return {
            ...app,
            queueStatus: queueEntry ? queueEntry.status : 'Unknown',
            email: app.email || 'Not provided'
          };
        });
        
        filteredAppointments = [...appointments];
        
        // Update stats and charts
        updateAppointmentStats();
        updateCharts();
        renderAppointmentsTable();
        
      } catch (error) {
        console.error('Error fetching appointment data:', error);
        showErrorState();
      }
    }

    // Update appointment statistics
    function updateAppointmentStats() {
      // Total appointments
      document.getElementById('totalAppointments').textContent = appointments.length;
      updateStatChange('totalAppointmentsStat', 0); // No change data in this example
      
      // Completed services
      const completedCount = appointments.filter(app => app.status === 'Completed').length;
      document.getElementById('completedServices').textContent = completedCount;
      updateStatChange('completedServicesStat', 0);
      
      // Average wait time (placeholder - would need actual wait time data)
      document.getElementById('avgWaitTime').textContent = '15 mins';
      updateStatChange('avgWaitTimeStat', 0);
      
      // Cancellation rate
      const cancelledCount = appointments.filter(app => app.status === 'Cancelled').length;
      const cancellationRate = appointments.length > 0 ? 
        Math.round((cancelledCount / appointments.length) * 100) : 0;
      document.getElementById('cancellationRate').textContent = `${cancellationRate}%`;
      updateStatChange('cancellationRateStat', 0);
    }

    function updateStatChange(statId, change) {
      const statChangeEl = document.getElementById(statId).querySelector('.stat-change');
      
      if (change > 0) {
        statChangeEl.innerHTML = `<i class="fas fa-arrow-up"></i> ${Math.abs(change)}% from last period`;
        statChangeEl.className = 'stat-change positive';
      } else if (change < 0) {
        statChangeEl.innerHTML = `<i class="fas fa-arrow-down"></i> ${Math.abs(change)}% from last period`;
        statChangeEl.className = 'stat-change negative';
      } else {
        statChangeEl.innerHTML = '<i class="fas fa-equals"></i> No change data';
        statChangeEl.className = 'stat-change neutral';
      }
    }

    // Update charts with appointment data
    function updateCharts() {
      // Update daily appointments chart (last 7 days)
      const today = new Date();
      const dailyLabels = [];
      const dailyBooked = [];
      const dailyCompleted = [];
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(today.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        dailyLabels.push(date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }));
        
        const bookedCount = appointments.filter(app => 
          new Date(app.dateTime).toISOString().split('T')[0] === dateStr
        ).length;
        
        const completedCount = appointments.filter(app => 
          app.status === 'Completed' && 
          new Date(app.dateTime).toISOString().split('T')[0] === dateStr
        ).length;
        
        dailyBooked.push(bookedCount);
        dailyCompleted.push(completedCount);
      }
      
      charts.dailyAppointmentsChart.data.labels = dailyLabels;
      charts.dailyAppointmentsChart.data.datasets = [
        {
          label: 'Booked',
          data: dailyBooked,
          borderColor: '#4361ee',
          backgroundColor: 'rgba(67, 97, 238, 0.1)',
          tension: 0.3,
          fill: true
        },
        {
          label: 'Completed',
          data: dailyCompleted,
          borderColor: '#4cc9f0',
          backgroundColor: 'rgba(76, 201, 240, 0.1)',
          tension: 0.3,
          fill: true
        }
      ];
      charts.dailyAppointmentsChart.update();
      
      // Update center distribution chart
      const centers = [...new Set(appointments.map(app => app.center))];
      const centerCounts = centers.map(center => 
        appointments.filter(app => app.center === center).length
      );
      
      charts.centerDistributionChart.data.labels = centers;
      charts.centerDistributionChart.data.datasets = [{
        label: 'Appointments by Center',
        data: centerCounts,
        backgroundColor: centers.map((_, i) => 
          i % 2 === 0 ? 'rgba(67, 97, 238, 0.7)' : 'rgba(76, 201, 240, 0.7)'
        ),
        borderColor: centers.map((_, i) => 
          i % 2 === 0 ? 'rgba(67, 97, 238, 1)' : 'rgba(76, 201, 240, 1)'
        ),
        borderWidth: 1
      }];
      charts.centerDistributionChart.update();
      
      // Update service distribution chart
      const services = [...new Set(appointments.map(app => app.service))];
      const serviceCounts = services.map(service => 
        appointments.filter(app => app.service === service).length
      );
      
      charts.serviceDistributionChart.data.labels = services;
      charts.serviceDistributionChart.data.datasets = [{
        data: serviceCounts,
        backgroundColor: [
          '#4361ee', '#4cc9f0', '#3f37c9', '#4895ef', 
          '#560bad', '#7209b7', '#b5179e'
        ],
        borderWidth: 1
      }];
      charts.serviceDistributionChart.update();
      
      // Update status distribution chart
      const statusCounts = {
        'Pending': appointments.filter(app => app.status === 'Pending').length,
        'Confirmed': appointments.filter(app => app.status === 'Confirmed').length,
        'Completed': appointments.filter(app => app.status === 'Completed').length,
        'Cancelled': appointments.filter(app => app.status === 'Cancelled').length,
        'No Show': appointments.filter(app => app.status === 'No Show').length
      };
      
      charts.statusDistributionChart.data.labels = Object.keys(statusCounts);
      charts.statusDistributionChart.data.datasets = [{
        data: Object.values(statusCounts),
        backgroundColor: [
          '#fff3cd', // Pending
          '#cce5ff', // Confirmed
          '#d4edda', // Completed
          '#f8d7da', // Cancelled
          '#e2e3e5'  // No Show
        ],
        borderColor: [
          '#856404', // Pending
          '#004085', // Confirmed
          '#155724', // Completed
          '#721c24', // Cancelled
          '#383d41'  // No Show
        ],
        borderWidth: 1
      }];
      charts.statusDistributionChart.update();
    }

    // Render appointments table
    function renderAppointmentsTable() {
      const startIndex = (currentAppointmentsPage - 1) * appointmentsPerPage;
      const endIndex = startIndex + appointmentsPerPage;
      const paginatedData = filteredAppointments.slice(startIndex, endIndex);
      
      const tableBody = document.getElementById('appointmentsTableBody');
      tableBody.innerHTML = '';
      
      if (paginatedData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="9" class="text-center py-4">
              No appointments found matching your criteria
            </td>
          </tr>
        `;
      } else {
        paginatedData.forEach(appointment => {
          const row = document.createElement('tr');
          const dateTime = new Date(appointment.dateTime);
          const formattedDate = dateTime.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });
          const formattedTime = dateTime.toLocaleTimeString('en-US', {
            hour: '2-digit',
            minute: '2-digit'
          });
          
          // Determine status badge class
          let statusClass = 'pending';
          if (appointment.status === 'Confirmed') statusClass = 'in-progress';
          if (appointment.status === 'Completed') statusClass = 'completed';
          if (appointment.status === 'Cancelled' || appointment.status === 'No Show') statusClass = 'failed';
          
          // Queue status
          let queueStatusClass = 'pending';
          if (appointment.queueStatus === 'Processing') queueStatusClass = 'in-progress';
          if (appointment.queueStatus === 'Completed') queueStatusClass = 'completed';
          
          row.innerHTML = `
            <td>${appointment.id}</td>
            <td>${appointment.clientName}</td>
            <td>${appointment.phone}</td>
            <td>${appointment.email || '-'}</td>
            <td>${appointment.service}</td>
            <td>${appointment.center}</td>
            <td>${formattedDate} ${formattedTime}</td>
            <td><span class="status-badge ${statusClass}">${appointment.status}</span></td>
            <td><span class="status-badge ${queueStatusClass}">${appointment.queueStatus || 'N/A'}</span></td>
          `;
          tableBody.appendChild(row);
        });
      }
      
      // Update pagination info
      document.getElementById('showingFrom').textContent = filteredAppointments.length > 0 ? startIndex + 1 : 0;
      document.getElementById('showingTo').textContent = Math.min(endIndex, filteredAppointments.length);
      document.getElementById('totalAppointmentsCount').textContent = filteredAppointments.length;
      
      // Update pagination controls
      updatePaginationControls();
    }

    function updatePaginationControls() {
      const totalPages = Math.ceil(filteredAppointments.length / appointmentsPerPage);
      const paginationControls = document.getElementById('appointmentsPagination');
      
      // Clear existing buttons (keep prev/next)
      paginationControls.innerHTML = '';
      
      // Add prev button
      const prevBtn = document.createElement('button');
      prevBtn.className = 'pagination-btn';
      prevBtn.disabled = currentAppointmentsPage === 1;
      prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
      prevBtn.addEventListener('click', () => {
        if (currentAppointmentsPage > 1) {
          currentAppointmentsPage--;
          renderAppointmentsTable();
        }
      });
      paginationControls.appendChild(prevBtn);
      
      // Add page buttons
      const maxVisiblePages = 5;
      let startPage = Math.max(1, currentAppointmentsPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
      if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }
      
      if (startPage > 1) {
        const firstBtn = document.createElement('button');
        firstBtn.className = 'pagination-btn';
        firstBtn.textContent = '1';
        firstBtn.addEventListener('click', () => {
          currentAppointmentsPage = 1;
          renderAppointmentsTable();
        });
        paginationControls.appendChild(firstBtn);
        
        if (startPage > 2) {
          const ellipsis = document.createElement('span');
          ellipsis.textContent = '...';
          ellipsis.style.padding = '0 10px';
          paginationControls.appendChild(ellipsis);
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `pagination-btn ${i === currentAppointmentsPage ? 'active' : ''}`;
        pageBtn.textContent = i;
        pageBtn.addEventListener('click', () => {
          currentAppointmentsPage = i;
          renderAppointmentsTable();
        });
        paginationControls.appendChild(pageBtn);
      }
      
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          const ellipsis = document.createElement('span');
          ellipsis.textContent = '...';
          ellipsis.style.padding = '0 10px';
          paginationControls.appendChild(ellipsis);
        }
        
        const lastBtn = document.createElement('button');
        lastBtn.className = 'pagination-btn';
        lastBtn.textContent = totalPages;
        lastBtn.addEventListener('click', () => {
          currentAppointmentsPage = totalPages;
          renderAppointmentsTable();
        });
        paginationControls.appendChild(lastBtn);
      }
      
      // Add next button
      const nextBtn = document.createElement('button');
      nextBtn.className = 'pagination-btn';
      nextBtn.disabled = currentAppointmentsPage === totalPages || totalPages === 0;
      nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
      nextBtn.addEventListener('click', () => {
        if (currentAppointmentsPage < totalPages) {
          currentAppointmentsPage++;
          renderAppointmentsTable();
        }
      });
      paginationControls.appendChild(nextBtn);
    }

    // Apply filters to appointments
    function applyAppointmentFilters() {
      const dateFilter = document.getElementById('appointmentDateFilter').value;
      const serviceFilter = document.getElementById('appointmentServiceFilter').value;
      const centerFilter = document.getElementById('appointmentCenterFilter').value;
      const statusFilter = document.getElementById('appointmentStatusFilter').value;
      
      filteredAppointments = appointments.filter(appointment => {
        // Filter by date range if specified
        if (dateFilter) {
          const dates = dateFilter.split(' to ');
          const startDate = new Date(dates[0]);
          const endDate = dates[1] ? new Date(dates[1]) : new Date(dates[0]);
          
          const appointmentDate = new Date(appointment.dateTime.split(' ')[0]);
          
          if (appointmentDate < startDate || appointmentDate > endDate) {
            return false;
          }
        }
        
        // Filter by service if specified
        if (serviceFilter && appointment.service !== serviceFilter) {
          return false;
        }
        
        // Filter by center if specified
        if (centerFilter && appointment.center !== centerFilter) {
          return false;
        }
        
        // Filter by status if specified
        if (statusFilter && appointment.status !== statusFilter) {
          return false;
        }
        
        return true;
      });
      
      // Reset to first page
      currentAppointmentsPage = 1;
      renderAppointmentsTable();
    }

    // Show error state
    function showErrorState() {
      document.getElementById('appointmentsTableBody').innerHTML = `
        <tr>
          <td colspan="9" class="text-center py-4 text-danger">
            <i class="fas fa-exclamation-circle"></i> Failed to load appointments. Please try again.
          </td>
        </tr>
      `;
    }

    // PDF Report Generator
    function generatePDFReport(name, type, startDate, endDate, notes) {
      // Initialize jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // Add title
      doc.setFontSize(18);
      doc.text(name, 105, 20, { align: 'center' });
      
      // Add report details
      doc.setFontSize(12);
      doc.text(`Report Type: ${type}`, 20, 30);
      doc.text(`Date Range: ${startDate} to ${endDate}`, 20, 40);
      
      // Add notes if provided
      if (notes) {
        doc.text('Notes:', 20, 50);
        const splitNotes = doc.splitTextToSize(notes, 170);
        doc.text(splitNotes, 20, 60);
      }
      
      // Add content based on report type
      let yPosition = notes ? 80 : 60;
      
      if (type === 'Appointments') {
        // Add appointments summary
        doc.setFontSize(14);
        doc.text('Appointments Summary', 20, yPosition);
        yPosition += 10;
        
        // Add stats
        doc.setFontSize(12);
        doc.text(`Total Appointments: ${document.getElementById('totalAppointments').textContent}`, 20, yPosition);
        yPosition += 10;
        doc.text(`Completed Services: ${document.getElementById('completedServices').textContent}`, 20, yPosition);
        yPosition += 10;
        doc.text(`Average Wait Time: ${document.getElementById('avgWaitTime').textContent}`, 20, yPosition);
        yPosition += 10;
        doc.text(`Cancellation Rate: ${document.getElementById('cancellationRate').textContent}`, 20, yPosition);
        yPosition += 20;
        
        // Add charts as images (simplified for this example)
        doc.text('Appointments Overview:', 20, yPosition);
        yPosition += 10;
        
        // In a real implementation, you would convert the charts to images and add them
        // For now, we'll just add text representations
        doc.text('Daily Appointments: See attached chart in web interface', 20, yPosition);
        yPosition += 10;
        doc.text('Center Distribution: See attached chart in web interface', 20, yPosition);
        yPosition += 10;
        doc.text('Service Distribution: See attached chart in web interface', 20, yPosition);
        yPosition += 10;
        doc.text('Status Distribution: See attached chart in web interface', 20, yPosition);
        yPosition += 20;
        
        // Add table data
        doc.setFontSize(14);
        doc.text('Appointments Data', 20, yPosition);
        yPosition += 10;
        
        // Add table headers
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.text('Ref No', 20, yPosition);
        doc.text('Client', 40, yPosition);
        doc.text('Service', 80, yPosition);
        doc.text('Center', 120, yPosition);
        doc.text('Date', 160, yPosition);
        doc.text('Status', 190, yPosition);
        yPosition += 10;
        doc.setFont(undefined, 'normal');
        
        // Add table rows
        filteredAppointments.forEach(app => {
          if (yPosition > 270) { // Add new page if we're near the bottom
            doc.addPage();
            yPosition = 20;
          }
          
          const date = new Date(app.dateTime);
          const dateStr = date.toLocaleDateString();
          
          doc.text(app.id, 20, yPosition);
          doc.text(app.clientName.substring(0, 15), 40, yPosition);
          doc.text(app.service.substring(0, 15), 80, yPosition);
          doc.text(app.center.substring(0, 10), 120, yPosition);
          doc.text(dateStr, 160, yPosition);
          doc.text(app.status, 190, yPosition);
          yPosition += 10;
        });
      } else if (type === 'Performance') {
        // Performance report content
        doc.text('Performance metrics would be included here', 20, yPosition);
      } else {
        // System report content
        doc.text('System metrics would be included here', 20, yPosition);
      }
      
      // Save the PDF
      doc.save(`${name.replace(/ /g, '_')}.pdf`);
    }

    // Excel Report Generator
    function generateExcelReport(name, type, startDate, endDate, notes) {
      // Create a new workbook
      const wb = XLSX.utils.book_new();
      
      // Create worksheets based on report type
      if (type === 'Appointments') {
        // Summary sheet
        const summaryData = [
          ['Report Name', name],
          ['Report Type', type],
          ['Date Range', `${startDate} to ${endDate}`],
          ['Notes', notes],
          [],
          ['Appointments Summary', ''],
          ['Total Appointments', document.getElementById('totalAppointments').textContent],
          ['Completed Services', document.getElementById('completedServices').textContent],
          ['Average Wait Time', document.getElementById('avgWaitTime').textContent],
          ['Cancellation Rate', document.getElementById('cancellationRate').textContent]
        ];
        
        const summarySheet = XLSX.utils.aoa_to_sheet(summaryData);
        XLSX.utils.book_append_sheet(wb, summarySheet, 'Summary');
        
        // Data sheet
        const appointmentsData = filteredAppointments.map(app => ({
          'Ref No': app.id,
          'Client Name': app.clientName,
          'Phone': app.phone,
          'Email': app.email || '',
          'Service': app.service,
          'Center': app.center,
          'Date': new Date(app.dateTime).toLocaleDateString(),
          'Time': new Date(app.dateTime).toLocaleTimeString(),
          'Status': app.status,
          'Queue Status': app.queueStatus || 'N/A'
        }));
        
        const dataSheet = XLSX.utils.json_to_sheet(appointmentsData);
        XLSX.utils.book_append_sheet(wb, dataSheet, 'Appointments');
      } else {
        // For other report types, create a simple sheet
        const data = [
          ['Report Name', name],
          ['Report Type', type],
          ['Date Range', `${startDate} to ${endDate}`],
          ['Notes', notes],
          [],
          ['Data', 'Would be populated based on actual data']
        ];
        
        const sheet = XLSX.utils.aoa_to_sheet(data);
        XLSX.utils.book_append_sheet(wb, sheet, 'Report');
      }
      
      // Export the workbook
      XLSX.writeFile(wb, `${name.replace(/ /g, '_')}.xlsx`);
    }

    // CSV Report Generator
    function generateCSVReport(name, type, startDate, endDate, notes) {
      let csvContent = '';
      
      // Add header
      csvContent += `Report Name,${name}\n`;
      csvContent += `Report Type,${type}\n`;
      csvContent += `Date Range,${startDate} to ${endDate}\n`;
      csvContent += `Notes,${notes || ''}\n\n`;
      
      if (type === 'Appointments') {
        // Add summary
        csvContent += 'Appointments Summary\n';
        csvContent += `Total Appointments,${document.getElementById('totalAppointments').textContent}\n`;
        csvContent += `Completed Services,${document.getElementById('completedServices').textContent}\n`;
        csvContent += `Average Wait Time,${document.getElementById('avgWaitTime').textContent}\n`;
        csvContent += `Cancellation Rate,${document.getElementById('cancellationRate').textContent}\n\n`;
        
        // Add data headers
        csvContent += 'Ref No,Client Name,Phone,Email,Service,Center,Date,Time,Status,Queue Status\n';
        
        // Add data rows
        filteredAppointments.forEach(app => {
          const date = new Date(app.dateTime);
          csvContent += `${app.id},"${app.clientName}","${app.phone}","${app.email || ''}","${app.service}","${app.center}",`;
          csvContent += `${date.toLocaleDateString()},${date.toLocaleTimeString()},"${app.status}","${app.queueStatus || 'N/A'}"\n`;
        });
      } else {
        csvContent += 'Report Data\n';
        csvContent += 'Data would be populated based on actual report type\n';
      }
      
      // Create and download the CSV file
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      saveAs(blob, `${name.replace(/ /g, '_')}.csv`);
    }

    // Set up event listeners
    function setupEventListeners() {
      // Tab navigation
      document.getElementById('appointmentsTab').addEventListener('click', function() {
        document.getElementById('appointmentsReportSection').style.display = 'block';
        document.getElementById('performanceReportSection').style.display = 'none';
        document.getElementById('systemReportSection').style.display = 'none';
        
        // Update active tab
        document.querySelectorAll('.quick-actions .action-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        this.classList.add('active');
      });
      
      document.getElementById('performanceTab').addEventListener('click', function() {
        document.getElementById('appointmentsReportSection').style.display = 'none';
        document.getElementById('performanceReportSection').style.display = 'block';
        document.getElementById('systemReportSection').style.display = 'none';
        
        // Update active tab
        document.querySelectorAll('.quick-actions .action-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        this.classList.add('active');
      });
      
      document.getElementById('systemTab').addEventListener('click', function() {
        document.getElementById('appointmentsReportSection').style.display = 'none';
        document.getElementById('performanceReportSection').style.display = 'none';
        document.getElementById('systemReportSection').style.display = 'block';
        
        // Update active tab
        document.querySelectorAll('.quick-actions .action-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        this.classList.add('active');
      });
      
      // Apply filters button
      document.getElementById('applyAppointmentFilters').addEventListener('click', applyAppointmentFilters);
      
      // Generate report button
      document.getElementById('generateReportBtn').addEventListener('click', function() {
        document.getElementById('generateReportModal').classList.add('show');
      });
      
      // Generate report modal button
      document.getElementById('generateReport').addEventListener('click', function() {
        const reportName = document.getElementById('reportName').value;
        const reportType = document.getElementById('reportType').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const reportFormat = document.getElementById('reportFormat').value;
        const reportNotes = document.getElementById('reportNotes').value;
        
        // Close the modal
        document.getElementById('generateReportModal').classList.remove('show');
        
        // Generate report based on format
        switch(reportFormat) {
          case 'PDF':
            generatePDFReport(reportName, reportType, startDate, endDate, reportNotes);
            break;
          case 'Excel':
            generateExcelReport(reportName, reportType, startDate, endDate, reportNotes);
            break;
          case 'CSV':
            generateCSVReport(reportName, reportType, startDate, endDate, reportNotes);
            break;
        }
      });
      
      // Close modal button
      document.getElementById('cancelReport').addEventListener('click', function() {
        document.getElementById('generateReportModal').classList.remove('show');
      });
      
      // Close modal button
      document.getElementById('closeModal').addEventListener('click', function() {
        document.getElementById('generateReportModal').classList.remove('show');
      });
      
      // Profile dropdown
      document.getElementById('profileDropdown').addEventListener('click', function(e) {
        e.stopPropagation();
        document.getElementById('dropdownMenu').classList.toggle('show');
      });
      
      // Close dropdown when clicking outside
      window.addEventListener('click', function() {
        document.getElementById('dropdownMenu').classList.remove('show');
      });
    }
  </script>
</body>
</html>